<!DOCTYPE html>
<!--
Copyright (C) 2016 maxim

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<html>
    <head>
        <meta charset="UTF-8">
        <title>GPS brainstorm tool</title>
        <link rel="stylesheet" type="text/css" href="slick/slick.css"/>
        <link rel="stylesheet" type="text/css" href="slick/slick-theme.css"/>
        <link rel="stylesheet" type="text/css" href="style.css"/>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ngStorage/0.3.6/ngStorage.min.js"></script>


        
    </head>
    <body>
        
        <div class="single-item" ng-app="app" ng-controller="ctrl">
            <div>              
                <question></question>
                <input ng-model="$storage.question" placeholder="Vul hier de vraag in...">
            </div>
            <div>
                <div class="ideas" id="redIdeas">
                    <h2>RODE IDEEËN</h2>
                    <h3>korte termijn: snel realiseerbaar</h3>
                    <idea-list type="red"></idea-list>
                    <idea-input type="red"></idea-input>
                </div>
                <div class="ideas" id="yellowIdeas">
                    <h2>GELE IDEEËN</h2>
                    <h3>lange termijn: haalbaarheid moet onderzocht worden</h3>
                    <idea-list type="yellow"></idea-list>
                    <idea-input type="yellow"></idea-input>
                </div>
            </div>
            <div>
                                <h1>Einde</h1>
            </div>
        </div>
        
        <script type="text/javascript" src="//code.jquery.com/jquery-3.1.1.min.js"></script>
        <script type="text/javascript" src="slick/slick.min.js"></script>
        
        <script type="text/javascript">
          $(document).ready(function(){
            var initialSlide = localStorage.slide || 0;
            $('.single-item').slick({
                dots: true,
                infinite: false,
                initialSlide: JSON.parse(initialSlide)
            });
        });
        // On before slide change
        $('.single-item').on('afterChange', function(event, slick, currentSlide, nextSlide){
          localStorage.slide = currentSlide;
        });
        $("body").keydown(function(e){
            switch(e.which) {
        case 37: // left
            $('.single-item').slick('slickPrev');
        break;
        
        case 39: // right
            $('.single-item').slick('slickNext'); 
        break;
        
        default: return; 
    }
    e.preventDefault();
});            
        </script>
        
        <script type="text/javascript">
            var app = angular.module('app', ['ngStorage']);

            app.controller('ctrl', function($scope,$localStorage) {
                $scope.$storage = $localStorage.$default({
                    "question": "",
                    "ideas": new Array(),
                    "yellow": "",
                    "red": ""
                });
                $scope.addIdea = function(color) {
                    var ideastring = $scope.$storage[color].toString();
                    if(!!ideastring){
                    var idea = new Object();
                    idea["q"] = ideastring;
                    idea["t"] = color;
                    idea["c"] = 0;
                    $scope.$storage.ideas.push(idea);
                    }
                    $scope.$storage[color] = "";
                };
                $scope.removeIdea = function(idea) {
                    var index = $scope.$storage.ideas.indexOf(idea);
                    console.log(index);
                    $scope.$storage.ideas.splice(index, 1);
                };
                
                $scope.upvoteIdea = function(idea) {
                    idea["c"] = idea["c"] + 1;
                }
                
                 $scope.downvoteIdea = function(idea) {
                    if(idea["c"]>0) idea["c"] = idea["c"] - 1;
                }
                
            });
            
            app.directive('question', function() {
                return {
                  template: '<h1>{{$storage.question}}</h1>'
                };
            });
            
            app.directive('ideaList', function(){
                return {
                    template: function(tElem, tAttrs){
                        return '<ul>'+
                        '<li ng-repeat="idea in $storage.ideas | filter: {t: \''+tAttrs.type+'\'}">'+
                          '{{ idea.q + \' (\' + idea.c + \')\'}}'+
                          ' <a ng-click="removeIdea(idea)">Delete</a>'+
                          ' <a ng-click="upvoteIdea(idea)">Upvote</a>'+
                          ' <a ng-click="downvoteIdea(idea)">Downvote</a>'+
                        '</li>'+                        
                    '</ul>';
                    }
                };
            });
            
            app.directive('ideaInput', function(){
                return {
                    template: function(tElem, tAttrs){
                        return '<form ng-controller="ctrl" ng-submit="addIdea(\''+tAttrs.type+'\')">'+
                                '<input type="text" ng-model="$storage.'+tAttrs.type+'" >'+
                                '<input type="submit" value="Voeg toe"/>'+
                                '</form>';
                    }
                };
            });
            
            </script>
        
        
       
    </body>
</html>
